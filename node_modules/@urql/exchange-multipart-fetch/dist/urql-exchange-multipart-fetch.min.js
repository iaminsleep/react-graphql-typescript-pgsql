Object.defineProperty(exports,"__esModule",{value:!0});var e=require("wonka"),r=require("extract-files"),a=require("@urql/core/internal");exports.multipartFetchExchange=({forward:t})=>i=>{var n=e.share(i),o=e.mergeMap((t=>{var i,o,d=e.filter((e=>"teardown"===e.kind&&e.key===t.key))(n),{files:s,clone:p}=r.extractFiles({...t.variables}),c=a.makeFetchBody({query:t.query,variables:p});if(s.size){i=a.makeFetchURL(t),"application/json"===(o=a.makeFetchOptions(t)).headers["content-type"]&&delete o.headers["content-type"],o.method="POST",o.body=new FormData,o.body.append("operations",JSON.stringify(c));var l={},u=0;s.forEach((e=>{l[++u]=e.map((e=>`variables.${e}`))})),o.body.append("map",JSON.stringify(l)),u=0,s.forEach(((e,r)=>{o.body.append(""+ ++u,r,r.name)}))}else i=a.makeFetchURL(t,c),o=a.makeFetchOptions(t,c);return e.onPush((e=>{}))(e.takeUntil(d)(a.makeFetchSource(t,i,o)))}))(e.filter((e=>"query"===e.kind||"mutation"===e.kind))(n)),d=t(e.filter((e=>"query"!==e.kind&&"mutation"!==e.kind))(n));return e.merge([o,d])};
//# sourceMappingURL=urql-exchange-multipart-fetch.min.js.map
